<div class="min-h-screen bg-app-bg text-app-text p-6 font-sans transition-colors duration-500">
  <!--   État : EN JEU -->
  @if (store.status() === 'playing') {
  <div class="max-w-md mx-auto space-y-6">
    <!-- Header : Catégorie + Timer -->
    <div class="flex justify-between items-center mb-2">
      <div class="flex items-center gap-3">
        <div [class]="'w-10 h-10 rounded-full border-2 flex items-center justify-center text-sm font-bold transition-colors ' + (store.timeLeft() <= 3 ? 'border-red-500 text-red-500 animate-pulse' : 'border-blue-500 text-blue-500')">
          {{ store.timeLeft() }}
        </div>
        <div class="text-center">
          <span class="text-[8px] uppercase tracking-tighter text-brand font-black">{{ store.currentQuestion().category }}</span>
          <p class="text-[10px] opacity-50 leading-none">{{ store.currentIndex() + 1 }}/100</p>
        </div>
      </div>

      <!-- Bloc Score Adaptatif -->
      <div class="bg-app-card px-3 py-1 rounded-lg border border-app-border flex items-center gap-2 shadow-sm">
        <lucide-icon name="target" class="w-3.5 h-3.5 text-brand" [strokeWidth]="2.5"></lucide-icon>
        <span class="text-[13px] font-bold text-brand italic uppercase tracking-tighter">Score: {{ store.score() }}</span>
      </div>
    </div>

    <ql-progress-bar [current]="store.currentIndex() + 1" [total]="100" class="mb-4"></ql-progress-bar>

    <!-- La Question (Carte Adaptative) -->
    <div class="bg-app-card border border-app-border p-4 rounded-2xl mb-4 min-h-[80px] flex items-center justify-center shadow-md">
      <p class="text-base md:text-lg font-bold text-center leading-snug">
        {{ store.currentQuestion().label }}
      </p>
    </div>

    <!-- Les Réponses (Boutons Adaptatifs) -->
    <div class="grid gap-2">
      @for (option of store.currentQuestion().options; track $index) {
      <button (click)="store.answerQuestion($index)" 
        class="w-full text-left py-3 px-4 rounded-xl bg-app-card border border-app-border active:bg-blue-600 active:text-white transition-all shadow-sm">
        <div class="flex items-center gap-3">
          <span class="w-6 h-6 rounded-md bg-app-bg border border-app-border flex items-center justify-center text-[10px] font-black italic">
            {{ ['A', 'B', 'C', 'D'][$index] }}
          </span>
          <span class="text-sm font-medium">{{ option }}</span>
        </div>
      </button>
      }
    </div>
  </div>
  }

  <!-- ÉTAT : PAUSE DE SURVIE -->
  @if (store.status() === 'break') {
  <div class="min-h-[100dvh] flex flex-col items-center justify-between p-4 text-center animate-fadeIn bg-app-bg">
    <div class="mt-4">
      <div class="inline-block px-3 py-0.5 rounded-full bg-blue-500/10 text-brand text-[10px] font-black uppercase tracking-widest mb-2 border border-app-border">
        Palier {{ store.currentIndex() / 25 }} / 4 Atteint
      </div>
      <h1 class="text-3xl font-black italic tracking-tighter uppercase leading-none">
        PAUSE DE <span class="text-brand text-4xl block">SURVIE</span>
      </h1>
    </div>

    <div class="w-full bg-app-card border border-app-border rounded-[2rem] p-5 shadow-2xl">
      <div class="flex gap-1 mb-6">
        @for (i of [1,2,3,4]; track i) {
        <div [class]="'h-1.5 flex-1 rounded-full ' + (store.currentIndex() >= i*25 ? 'bg-brand shadow-[0_0_10px_rgba(59,130,246,0.3)]' : 'bg-app-border')"></div>
        }
      </div>

      <div class="grid grid-cols-2 gap-2 mb-6">
        <div class="border-r border-app-border text-app-text">
          <p class="text-2xl font-black leading-none">{{ store.currentIndex() }}</p>
          <p class="text-[9px] opacity-50 uppercase font-bold tracking-tighter">Questions</p>
        </div>
        <div>
          <p class="text-2xl font-black text-brand leading-none">{{ store.score() }}</p>
          <p class="text-[9px] opacity-50 uppercase font-bold tracking-tighter">Buts</p>
        </div>
      </div>
      <p class="text-xs italic leading-snug mb-6 px-2 opacity-80">"Le talent ne suffit pas. C'est l'endurance qui fera de toi <span class="text-brand font-black uppercase italic">L'Ootaku</span>."</p>
      <ql-button (clicked)="store.resumeQuiz()">CONTINUER LE MARATHON</ql-button>
    </div>

    <div (click)="openPremiumModal()" class="mb-4 cursor-pointer group active:scale-95">
      <p class="text-[9.5px] font-bold uppercase tracking-widest leading-tight group-hover:text-brand">
        <lucide-icon name="gem" class="w-3 h-3 inline-block mr-1 mb-1"></lucide-icon>
        Fatigué ? <span class="text-brand underline">Découvre le Pass Premium</span>
      </p>
    </div>
  </div>
  }

  <!-- État : GAME OVER -->
  @if (store.status() === 'game-over') {
  <div class="min-h-screen flex flex-col items-center justify-center p-4 text-center animate-fadeIn bg-app-bg">
    <div class="mb-6">
      <h1 class="text-2xl font-black italic tracking-tighter uppercase leading-none">MISSION <span class="text-brand">TERMINÉE</span></h1>
      <p class="text-[9px] opacity-50 font-black uppercase tracking-widest mt-2 italic">Analyse du potentiel terminée</p>
    </div>

    <!-- On garde le bleu pour la carte de score car c'est ton identité de marque -->
    <div class="w-full bg-blue-600 rounded-[2rem] p-8 shadow-2xl shadow-blue-500/20 relative overflow-hidden mb-6 text-white">
      <div class="relative z-10">
        <p class="text-[9px] uppercase font-black opacity-80 mb-1 tracking-[0.2em]">Potentiel Débloqué</p>
        <p class="text-3xl font-black leading-none italic">{{ store.score() }}/100</p>
        <lucide-icon name="crown" class="absolute -bottom-2 -right-2 w-20 h-20 text-white opacity-10 rotate-12"></lucide-icon>
      </div>
    </div>

    <!-- LinkedIn & Afrotaku (Adaptatifs) -->
    <div class="w-full grid grid-cols-2 gap-3 mb-8">
      <a href="https://www.linkedin.com/..." target="_blank" class="flex flex-col items-center gap-2 bg-app-card border border-app-border p-3 rounded-2xl active:scale-95 transition-all">
        <lucide-icon name="linkedin" class="w-4 h-4 text-blue-500"></lucide-icon>
        <span class="text-[9px] font-black uppercase text-app-text">L'Architecte</span>
      </a>
      <a href="https://chat.whatsapp.com/..." target="_blank" class="flex flex-col items-center gap-2 bg-app-card border border-app-border p-3 rounded-2xl active:scale-95 transition-all">
        <lucide-icon name="users" class="w-4 h-4 text-orange-500"></lucide-icon>
        <span class="text-[9px] font-black uppercase text-app-text">Le Clan</span>
      </a>
    </div>

    <!-- Partage -->
    <div class="w-full mb-8">
      <p class="text-[10px] font-black uppercase tracking-[0.3em] opacity-40 mb-4 italic">Propager le QL</p>
      <div class="grid grid-cols-3 gap-3">
        <button (click)="shareOnWhatsApp()" class="flex flex-col items-center gap-2 active:scale-95">
          <div class="w-full aspect-square bg-green-500/10 border border-green-500/20 rounded-xl flex items-center justify-center">
            <lucide-icon name="message-circle" class="w-6 h-6 text-green-500"></lucide-icon>
          </div>
          <span class="text-[8px] font-bold opacity-60 uppercase">WhatsApp</span>
        </button>
        <button (click)="shareOnFB()" class="flex flex-col items-center gap-2 active:scale-95">
          <div class="w-full aspect-square bg-blue-600/10 border border-blue-600/20 rounded-xl flex items-center justify-center">
            <lucide-icon name="facebook" class="w-6 h-6 text-blue-600"></lucide-icon>
          </div>
          <span class="text-[8px] font-bold opacity-60 uppercase">Facebook</span>
        </button>
        <button (click)="nativeShare()" class="flex flex-col items-center gap-2 active:scale-95">
          <div class="w-full aspect-square bg-app-card border border-app-border rounded-xl flex items-center justify-center">
            <lucide-icon name="share-2" class="w-6 h-6 text-app-text"></lucide-icon>
          </div>
          <span class="text-[8px] font-bold opacity-60 uppercase">Autres</span>
        </button>
      </div>
    </div>

    <!-- Actions -->
    <div class="w-full flex gap-3">
      <button (click)="store.reset(); store.startQuiz()" class="flex-1 bg-app-text text-app-bg font-black py-4 rounded-xl text-xs uppercase tracking-widest active:scale-95 transition-all">REJOUER</button>
      <button (click)="showLeaderboard.emit()" class="flex-1 bg-app-card border border-app-border text-app-text font-black py-4 rounded-xl text-[10px] uppercase tracking-[0.2em] flex items-center justify-center gap-2 active:scale-95 group">
        <lucide-icon name="bar-chart-3" class="w-4 h-4 text-brand"></lucide-icon>
        <span>MON RANG</span>
      </button>
    </div>

    <!-- BOUTON RESET DISCRET (Le bouton Senior) -->
    <div class="w-full mt-8 pt-4 border-t border-app-border">
      <button (click)="openResetModal()" class="mx-auto flex items-center gap-2 text-gray-500 active:text-red-500 transition-colors">
        <lucide-icon name="user-round-pen" class="w-3 h-3"></lucide-icon>
        <span class="text-[9px] font-black uppercase tracking-[0.2em]">Nouvelle Recrue</span>
      </button>
    </div>
  </div>
  }

  <!-- MODALE PREMIUM (Bottom Sheet Design) -->
  @if (isPremiumModalOpen()) {
  <div class="fixed inset-0 z-[100] flex items-end justify-center animate-fadeIn p-0">
    <div class="absolute inset-0 bg-slate-950/60 backdrop-blur-sm" (click)="isPremiumModalOpen.set(false)"></div>
    <div class="relative w-full bg-app-card border-t border-brand/30 rounded-t-[2.5rem] p-6 shadow-2xl animate-slideUp">
      <div class="w-12 h-1 bg-app-border rounded-full mx-auto mb-6"></div>
      <div class="text-center space-y-6">
        <div class="inline-block px-3 py-1 rounded-full bg-brand text-white text-[8px] font-black uppercase tracking-widest">STATUT : ÉLITE</div>
        <h2 class="text-2xl font-black italic tracking-tighter uppercase leading-none">DEVENEZ UNE <br /><span class="text-brand text-3xl">LÉGENDE.</span></h2>
        <ul class="text-left space-y-3">
          <li class="flex items-center gap-3 p-3 bg-app-bg border border-app-border rounded-xl">
            <lucide-icon name="zap" class="w-5 h-5 text-brand"></lucide-icon>
            <span class="text-xs font-bold uppercase tracking-tight">Zéro Pub (Focus Total)</span>
          </li>
          <li class="flex items-center gap-3 p-3 bg-app-bg border border-app-border rounded-xl">
            <lucide-icon name="crown" class="w-5 h-5 text-brand"></lucide-icon>
            <span class="text-xs font-bold uppercase tracking-tight">Thèmes Hardcore exclusifs</span>
          </li>
          <li class="flex items-center gap-3 p-3 bg-app-bg border border-app-border rounded-xl">
            <lucide-icon name="timer" class="w-5 h-5 text-brand"></lucide-icon>
            <span class="text-xs font-bold uppercase tracking-tight">Jokers de Survie</span>
          </li>
        </ul>
        <div class="text-4xl font-black italic">500 <span class="text-brand text-lg">FCFA</span></div>
        <button (click)="isPremiumModalOpen.set(false)" class="w-full bg-brand text-white font-black py-5 rounded-2xl uppercase tracking-widest text-sm shadow-xl active:scale-95">Bientôt disponible</button>
      </div>
    </div>
  </div>
  }
</div>

<!-- MODALE DE CONFIRMATION (DANGER ZONE) -->
@if (showResetConfirm()) {
  <div class="fixed inset-0 z-[300] flex items-center justify-center p-6 animate-fadeIn">
    
    <!-- Overlay plus sombre pour marquer la gravité -->
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-md" (click)="showResetConfirm.set(false)"></div>

    <!-- La Carte -->
    <div class="relative w-full max-w-xs bg-app-card border border-red-500/30 rounded-[2rem] p-6 shadow-[0_0_40px_rgba(239,68,68,0.2)] text-center overflow-hidden">
      
      <!-- Icône de danger -->
      <div class="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-red-500/20">
        <lucide-icon name="triangle-alert" class="w-8 h-8 text-red-500" [strokeWidth]="2.5"></lucide-icon>
      </div>

      <h3 class="text-xl font-black italic uppercase tracking-tighter mb-2">Nouvelle Recrue ?</h3>
      <p class="text-[11px] text-gray-500 uppercase font-bold leading-relaxed mb-6">
        Attention : Ton pseudo et tes records actuels seront <span class="text-red-500 underline">définitivement effacés</span> de ce terminal.
      </p>

      <div class="space-y-2">
        <!-- Bouton de confirmation (Rouge Danger) -->
        <button 
          (click)="confirmReset()"
          class="w-full bg-red-600 text-white font-black py-4 rounded-xl text-xs uppercase tracking-widest active:scale-95 transition-all shadow-lg shadow-red-600/20"
        >
          Confirmer l'effacement
        </button>

        <!-- Bouton Annuler -->
        <button 
          (click)="showResetConfirm.set(false)"
          class="w-full bg-transparent text-app-text opacity-50 font-black py-3 rounded-xl text-[10px] uppercase tracking-widest active:scale-95"
        >
          Annuler
        </button>
      </div>
    </div>
  </div>
}